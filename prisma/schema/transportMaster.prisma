model StudentTransportAssignment {
    id            String   @id @default(uuid())
    userId        String
    routeId       String
    vehicleId     String
    pickupPointId String
    assignedBy    String
    assignedAt    DateTime @default(now())
    updatedAt     DateTime @updatedAt

    // student user
    user User @relation("transport_student", fields: [userId], references: [id], onDelete: Cascade)

    // admin user who assigned
    assignedByUser User @relation("transport_admin", fields: [assignedBy], references: [id], onDelete: Cascade)

    route       Route       @relation(fields: [routeId], references: [id], onDelete: Cascade)
    vehicle     Vehicle     @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
    pickupPoint PickupPoint @relation(fields: [pickupPointId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@index([assignedBy])
    @@map("studentTransportAssignments")
}

model Route {
    id         String    @id @default(uuid())
    name       String
    startPoint String
    endPoint   String
    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt
    monthlyFee Int
    vehicles   Vehicle[]

    studentTransportAssignments StudentTransportAssignment[]
    routePickupPoints           RoutePickupPoints[]

    @@map("route")
}

model Vehicle {
    id         String   @id @default(uuid())
    routeId    String
    vehicleNo  String   @unique
    driverName String
    contactNo  String
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    route                       Route                        @relation(fields: [routeId], references: [id])
    studentTransportAssignments StudentTransportAssignment[]

    @@map("vehicle")
}

model PickupPoint {
    id String @id @default(uuid())

    name      String
    address   String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    studentTransportAssignments StudentTransportAssignment[]
    routePickupPoints           RoutePickupPoints[]

    @@map("pickupPoint")
}

model RoutePickupPoints {
    id            String   @id @default(uuid())
    routeId       String
    pickupPointId String
    stopOrder     Int
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt

    route       Route       @relation(fields: [routeId], references: [id], onDelete: Cascade)
    pickupPoint PickupPoint @relation(fields: [pickupPointId], references: [id], onDelete: Cascade)

    @@unique([routeId, pickupPointId])
    @@unique([routeId, stopOrder])
    @@map("routePickupPoint")
}
